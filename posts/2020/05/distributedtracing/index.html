<!doctype html><html lang><meta charset=utf-8><meta name=viewport content="width=device-width"><title>분산 시스템 추적 시스템 | 개발자 지호</title><link rel=stylesheet href=/css/eureka.min.css><script defer src=/js/eureka.min.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/solarized-light.min.css media=print onload="this.media='all',this.onload=null" crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js integrity="sha256-uNYoXefWRqv+PsIF/OflNmwtKM4lStn9yrz2gVl6ymo=" crossorigin></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X media=print onload="this.media='all',this.onload=null" crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-151941743-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-151941743-1')</script><link rel=icon type=image/png sizes=32x32 href=/images/jiho_huafb81788da7ee21cf8234b9b792a3f72_3334808_32x32_fill_box_center_2.png><link rel=apple-touch-icon sizes=180x180 href=/images/jiho_huafb81788da7ee21cf8234b9b792a3f72_3334808_180x180_fill_box_center_2.png><meta name=description content="분산 시스템 추적 시스템"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":2,"name":"분산 시스템 추적 시스템","item":"/posts/2020/05/distributedtracing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/2020/05/distributedtracing/"},"headline":"분산 시스템 추적 시스템 | 개발자 지호","datePublished":"2020-05-16T00:00:00+09:00","dateModified":"2020-05-16T00:00:00+09:00","wordCount":656,"author":{"@type":"Person","name":["jiho"]},"publisher":{"@type":"Person","name":"Jiho. Sung","logo":{"@type":"ImageObject","url":"/images/jiho.png"}},"description":"분산 시스템 추적 시스템"}</script><meta property="og:title" content="분산 시스템 추적 시스템 | 개발자 지호"><meta property="og:type" content="article"><meta property="og:image" content="/images/jiho.png"><meta property="og:url" content="/posts/2020/05/distributedtracing/"><meta property="og:description" content="분산 시스템 추적 시스템"><meta property="og:site_name" content="개발자 지호"><meta property="article:published_time" content="2020-05-16T00:00:00+09:00"><meta property="article:modified_time" content="2020-05-16T00:00:00+09:00"><meta property="article:section" content="posts"><meta property="article:tag" content="open tracing"><meta property="og:see_also" content="/posts/2021/03/zookeeperpractice/"><meta property="og:see_also" content="/posts/2020/03/nginxresourcelogdisable/"><meta property="og:see_also" content="/posts/2020/02/slf4jmdclogging/"><meta property="og:see_also" content="/posts/2020/01/rsocket/"><body class="flex flex-col min-h-screen"><header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm"><div class="w-full max-w-screen-xl mx-auto"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=='Auto'||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName('html')[0].classList.add('dark')</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="mr-6 text-primary-text text-xl font-bold">개발자 지호</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/authors/jiho/#about class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">About Me</a>
<a href=/posts/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item mr-4">Posts</a>
<a href=/categories/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">Categories</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka">Light</span>
<span class="px-4 py-1 hover:text-eureka">Dark</span>
<span class="px-4 py-1 hover:text-eureka">Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById('lightDarkMode');storageColorScheme==null||storageColorScheme=='Auto'?document.addEventListener('DOMContentLoaded',()=>{switchMode('Auto')}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'sun'),element.firstElementChild.classList.add('fa-sun')):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'moon'),element.firstElementChild.classList.add('fa-moon')),document.addEventListener('DOMContentLoaded',()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="flex-grow pt-16"><div class=pl-scrollbar><div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto"><div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12"><div class="col-span-2 lg:col-span-6 bg-secondary-bg rounded px-6 py-8"><h1 class="font-bold text-3xl text-primary-text">분산 시스템 추적 시스템</h1><div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text"><div class="mr-6 my-2"><i class="fas fa-calendar mr-1"></i><span>2020-05-16</span></div><div class="mr-6 my-2"><i class="fas fa-clock mr-1"></i><span></span></div><div class="mr-6 my-2"><i class="fas fa-folder mr-1"></i><a href=/categories/%EA%B0%9C%EB%B0%9C/ class=hover:text-eureka>개발</a></div><div class="mr-6 my-2"><i class="fas fa-th-list mr-1"></i><a href=/series/2020/ class=hover:text-eureka>2020</a></div></div><div class=content><p>이전 포스팅에서 MDC 를 이용한 로그를 남기고 여러 시스템간의 로그를 추적하는 기능에 대해서 포스팅을 했었다. <a href=https://4ppl3hun73r.github.io/post/2020/02/slf4jMDCLogging>Slf4j Mapped Diagnostic Context (MDC) 를 이용한 사용자 요청 추적</a> 나중에 확인해 보니 이미 MSA 환경에서의 요청 추적을 위한 기술들이 완성이 되어 있었다.</p><p>&ldquo;내가 생각하는 것은 이미 구현되어 있고 만약 없다면 누군가 만들고 있을 것이다&rdquo; 라는 오랜 격언을 다시 한번 새기면서 분산 시스템에서의 추적 시스템에 대해서 공부를 하였다.</p><h2 id=google-dapper>Google Dapper</h2><p><a href=https://research.google/pubs/pub36356/>Dapper, a Large-Scale Distributed Systems Tracing Infrastructure</a></p><p>역시 구글이다. 논문의 작성일은 2010년&mldr; 내가 막 취직한 꼬꼬마 시절에 이미 완성된 기술 디자인이 존재 했다.
후에 서술할 twitter 의 zipkin, uber의 jaeger 등 많은 추적 시스템은 이 Dapper 논문을 기반으로 구현되었다고 한다.</p><h2 id=핵심-컨셉>핵심 컨셉</h2><h3 id=spanid>SpanId</h3><p>하나의 작업의 단위로 새로운 호출시 신규 SpanId 생성한다. 첫번째로 생성되는 SpanId를 Root Span(TraceId)라고 부른다.
SpanId 발급은 최대한 가볍게 생성해야 하며, 중복이 발생할수 있음을 인정하고 발급한다.
zipkin과 jaeger는 모두 long 값을 기준으로 random으로 생성한다.</p><h2 id=opentracing-project>opentracing project</h2><p>주소 : <a href=https://opentracing.io/>https://opentracing.io/</a>
CNCF(Cloud Native Computing Foundation) 에서 지원하는 분산환경 추적을 위한 프로젝트이다.
언어 / 플랫폼에 구애받지 않고 분산 추적을 지원하는 API 를 제공하고 있다.
밑에서 이야기할 zipkin / jaeger 모두 이 opentracing api 에 기반을 두고 있다.</p><h3 id=zipkin-jaeger>zipkin, jaeger</h3><p>가장 많이 사용되는 솔루션으로는 twitter의 zipkin과 uber의 jaeger 가 있다. 둘다 강력한데 kubernetes 환경에서의 잠재력에 있얻서 jaeger가 더 많은 인기를 얻고 있다.
특히나 jaeger 는 zipkin API 와 호환이 되므로 jaeger로 먼저 구축하고 사용하다가 zipkin으로 넘어가는 방법도 하나의 방법이 될 수 있다.</p><h1 id=튜토리얼>튜토리얼</h1><p>java : <a href=https://github.com/yurishkuro/opentracing-tutorial/tree/master/java>https://github.com/yurishkuro/opentracing-tutorial/tree/master/java</a>
others : <a href=https://opentracing.io/docs/getting-started/tutorials/>https://opentracing.io/docs/getting-started/tutorials/</a></p></div><div class=my-4><a href=/tags/open-tracing/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#open tracing</a></div><div class="flex md:justify-end my-4"><a href=https://github.com/4ppl3Hun73r/blob/master/content/posts/2020/05/distributedTracing.md title="Edit this page"><i class="fas fa-edit mr-1"></i><span></span></a></div><div class=py-2><div class="flex flex-col md:flex-row items-center my-8"><a href=/authors/jiho/ class="w-24 h-24 md:mr-4"><img src=/images/jiho.png class="w-full bg-primary-bg rounded-full" alt=Avatar></a><div class="w-full md:w-auto mt-4 md:mt-0"><a href=/authors/jiho/ class="block font-bold text-lg pb-1 mb-2 border-b">Jiho</a>
<span class="block pb-2">재미있게 개발하자!</span>
<a href=https://github.com/4ppl3Hun73r class=mr-1><i class="fab fa-github"></i></a><a href=mailto:slayer1000@gmail.com class=mr-1><i class="fas fa-envelope"></i></a><a href=https://www.linkedin.com/in/jiho-sung-159a2075 class=mr-1><i class="fab fa-linkedin"></i></a><a href=/index.xml class=mr-1><i class="fas fa-rss"></i></a></div></div></div><div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t"><div><span class="block font-bold"></span><a href=/posts/2021/03/zookeeperpractice/ class=block>zookeeper 를 이용한 leader / client 구조 개발</a></div><div class="md:text-right mt-4 md:mt-0"><span class="block font-bold"></span><a href=/posts/2020/03/nginxresourcelogdisable/ class=block>nginx resource logging disable 처리</a></div></div></div><div class=col-span-2><div class="bg-secondary-bg rounded p-6"><h3 class="text-lg font-semibold mb-4"></h3><div class=content><a href=/posts/2021/03/zookeeperpractice/>zookeeper 를 이용한 leader / client 구조 개발</a><br><a href=/posts/2020/05/distributedtracing/>분산 시스템 추적 시스템</a><br><a href=/posts/2020/03/nginxresourcelogdisable/>nginx resource logging disable 처리</a><br><a href=/posts/2020/02/slf4jmdclogging/>Slf4j Mapped Diagnostic Context (MDC) 를 이용한 사용자 요청 추적</a><br><a href=/posts/2020/01/rsocket/>rSocket</a><br></div></div><div class="sticky top-16 z-10 hidden lg:block px-6 py-4 bg-primary-bg"><span class="text-lg font-semibold"></span></div><div class="sticky-toc hidden lg:block px-6 pb-6"><nav id=TableOfContents><ul><li><a href=#google-dapper>Google Dapper</a></li><li><a href=#핵심-컨셉>핵심 컨셉</a><ul><li><a href=#spanid>SpanId</a></li></ul></li><li><a href=#opentracing-project>opentracing project</a><ul><li><a href=#zipkin-jaeger>zipkin, jaeger</a></li></ul></li></ul></nav></div><script>window.addEventListener('DOMContentLoaded',()=>{enableStickyToc()})</script></div></div><script>document.addEventListener('DOMContentLoaded',()=>{hljs.initHighlightingOnLoad()})</script></div></div></main><footer class=pl-scrollbar><div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2021 <a href=4ppl3Hun73r.github.io/>지호</a> &#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>